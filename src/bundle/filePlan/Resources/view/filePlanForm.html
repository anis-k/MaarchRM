<div class="panel panel-default dataForm">
    <div class="panel-heading">
        <h4>File plan</h4>
    </div>
    <div class="panel-body">
        <?merge filePlan ?>
        <form id="filePlanForm">
            <div class="form-group">
                <label>Code</label>
                <?merge filePlan.filePlanCode.bool() @disabled ?>
                <input type="text" class="form-control" name="filePlanCode" placeholder="file plan code">
            </div>
            <div class="form-group">
                <label>Display name</label>
                <input type="text" class="form-control" name="displayName" placeholder="display name">
            </div>
        </form>
        <button type="button" class="btn btn-success [?merge filePlan.filePlanCode.bool().then('hide', '') ?]" id="addFilePlan">Save</button>
        <button type="button" class="btn btn-success  [?merge filePlan.filePlanCode.bool().then('', 'hide') ?]" id="modifyFilePlan">Save</button>
        <button type="button" class="btn btn-warning" id="cancelFilePlan">Cancel</button>
    </div>
</div>

<script>

    // Cancel
    $('#formContainer').on('click', "#cancelFilePlan", function () {
        clearForm();
    })

    // Add a file plan
    $('#formContainer').on('click', '#addFilePlan', function () {
        $('button').prop('disabled', 'true');

        var filePlan = {
            filePlanCode: $('#formContainer').find("[name='filePlanCode']").val(),
            displayName: $('#formContainer').find("[name='displayName']").val()
        }

        var parametre = {
            filePlan: filePlan
        }

        $.ajax({
            url: "/filePlan/addFilePlan",
            type: "POST",
            data: JSON.stringify(parametre),
            contentType: 'application/json',
            success: function (response) {
                response = JSON.parse(response);
                requestResult(response.message, response.status);
                clearForm();
                reloadTree();
            },
            error: function (response) {
                requestResult(response.responseText, false);
            }
        })
    })
    // Modify a file plan
    $('#contain').on('click', '#modifyFilePlan', function () {
        console.log("modify");
        $('button').prop('disabled', 'true');
        var filePlan = {
            filePlanCode: $('#formContainer').find("[name='filePlanCode']").val(),
            displayName: $('#formContainer').find("[name='displayName']").val()
        }

        var parametre = {
            filePlan: filePlan
        }
        $.ajax({
            url: "/filePlan/modifyFilePlan",
            type: "PUT",
            data: JSON.stringify(parametre),
            contentType: 'application/json',
            success: function (response) {
                response = JSON.parse(response);
                requestResult(response.message, response.status);
                clearForm();
                reloadTree();
            },
            error: function (response) {
                requestResult(response.responseText, false);
            }
        })
    })
    
</script>
