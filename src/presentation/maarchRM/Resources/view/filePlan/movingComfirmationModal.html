<div class="modal fade" id="moveFolderModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Move folder</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xs-2">
                        <i class="fa fa-exclamation-circle text-info pull-right" style="font-size: 36px"/>
                    </div>
                    <div class="col-xs-10">
                        <h4><span>Do you want to move</span> <i id="moveElementName" class="text-primary"/> <span>into</span> <i id="targetElementName" class="text-primary"/> ?</h4>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
                <button type="button" id="moveFolder" class="btn btn-success" data-dismiss="modal">Yes</button>
            </div>
        </div>
    </div>
</div>

<script>
MovingConfirmationModal = {
    target: null,
    element: null,

    show: function(element, target) {
        this.target = target;
        this.element = element;

        var targetId = target.attr('id');
        var parentId = element.data('parentid');

        if ((targetId == parentId) || 
            (!parentId && target.hasClass('organization')) ||
            (element.data('orgregnumber') != target.data('orgregnumber')) ||
            ($('#'+element.attr('id')).find('#'+targetId).length > 0)) {

            return;
        }

        $('#moveElementName').html(element.find('b').html());
        $('#targetElementName').html(target.find('b').html());
        $('#moveFolderModal').modal();
    },

    move: function() {
        if (this.element && this.target) {
            var parentFolderId = null;
            if (!this.target.hasClass('organization')) {
                parentFolderId = this.target.attr('id');
            }

            $.ajax({
                url         : '/filePlan/move/'+this.element.attr('id'),
                type        : 'PUT',
                data        : JSON.stringify({parentFolderId:parentFolderId}),
                contentType : 'application/json',
                dataType    : 'json',
                success     : function (response) {
                    gritter.show(response.message, response.status, response.errors);
                    if (response.status) {
                        MovingConfirmationModal.element.data('parentid', parentFolderId)
                                                       .data('path', MovingConfirmationModal.target.data('path')+'/'+MovingConfirmationModal.element.find('b').text());
                        BootstrapTree.move(MovingConfirmationModal.element, MovingConfirmationModal.target);
                    }
                },
                error       : function (response) {
                    gritter.show(response.responseText, false);
                }
            })
        }
    }
}

$('#moveFolder').click(function() {
    MovingConfirmationModal.move();
})

</script>