<div id="archiveRelationshipsTable" class="col-xs-12">
    <div class="col-xs-12">
        <?merge archive.relationshipTypes.inarray('affaire').bool() ?>
        <div>
            <h4><small><i class="fa fa-hashtag"/> Affaire </small></h4>
            <div class="col-xs-12">
                <?merge archive.childrenRelationships.bool() ?>
                <div>
                    <?merge archive.childrenRelationships ?>
                    <div class="col-xs-12 [?merge .typeCode.ifeq('chainage').then('hide', '') ?]">
                        <a class="viewRelatedArchive" data-archiveid="[?merge .relatedArchiveId ?]" href="#"><?merge .description.nomDossier ?> - <?merge .archive.originatorArchiveId ?></a>
                        &nbsp; &nbsp;<?merge modificationPrivilege.bool() ?><a href="#" data-archiveid="[?merge .archiveId ?]" data-procedurealier="[?merge .archive.originatorArchiveId ?]" data-typecode="[?merge .typeCode ?]" data-dossier="[?merge .description.nomDossier ?]" class="editRelationship"><i class="fa fa-edit"/></a>
                    </div>
                </div>
                <?merge archive.parentRelationships.bool() ?>
                <div>
                    <?merge archive.parentRelationships ?>
                    <div class="col-xs-12 [?merge .typeCode.ifeq('chainage').then('hide', '') ?]">
                        <a class="viewRelatedArchive" data-archiveid="[?merge .archiveId ?]" href="#"><?merge .description.nomDossier ?> - <?merge .archive.originatorArchiveId ?></a>
                        &nbsp; &nbsp;<?merge modificationPrivilege.bool() ?><a href="#" data-archiveid="[?merge .archiveId ?]" data-procedurealier="[?merge .parentArchive.originatorArchiveId ?]" data-typecode="[?merge .typeCode ?]" data-dossier="[?merge .description.nomDossier ?]" class="editRelationship"><i class="fa fa-edit"/></a>
                    </div>
                </div>
            </div>
        </div>
        <?merge archive.relationshipTypes.inarray('chainage').bool() ?>
        <div>
            <h4><small><i class="fa fa-hashtag"/> Chainage </small></h4>
            <div class="col-xs-12">
                <?merge archive.childrenRelationships.bool() ?>
                <div>
                    <?merge archive.childrenRelationships ?>
                    <div class="col-xs-12 [?merge .typeCode.ifeq('affaire').then('hide', '') ?]">
                        <a class="viewRelatedArchive" data-archiveid="[?merge .relatedArchiveId ?]" href="#"><?merge .description.chainage ?> - <?merge .archive.originatorArchiveId ?></a>
                        &nbsp; &nbsp;<?merge modificationPrivilege.bool() ?><a href="#" data-archiveid="[?merge .archiveId ?]" data-procedurealier="[?merge .archive.originatorArchiveId ?]" data-typecode="[?merge .typeCode ?]" data-chainage="[?merge .description.chainage ?]" class="editRelationship"><i class="fa fa-edit"/></a>
                    </div>
                </div>
                <?merge archive.parentRelationships.bool() ?>
                <div>
                    <?merge archive.parentRelationships ?>
                    <div class="col-xs-12 [?merge .typeCode.ifeq('affaire').then('hide', '') ?]">
                        <a class="viewRelatedArchive" data-archiveid="[?merge .archiveId ?]" href="#"><?merge .description.chainage ?> - <?merge .archive.originatorArchiveId ?></a>
                        &nbsp; &nbsp;<?merge modificationPrivilege.bool() ?><a href="#" data-archiveid="[?merge .archiveId ?]" data-procedurealier="[?merge .parentArchive.originatorArchiveId ?]" data-typecode="[?merge .typeCode ?]" data-chainage="[?merge .description.chainage ?]" class="editRelationship"><i class="fa fa-edit"/></a>
                    </div>
                </div>
            </div>
        </div>
        <?merge modificationPrivilege.bool() ?>
        <button id="addArchiveRelationship" class="btn btn-sm btn-default pull-right">
            <i class="fa fa-plus"> </i>
            Ajouter une relation
        </button>
    </div>
</div>

<div id="archiveRelationshipForm" class="col-xs-12 hide">
    <?hinclude recordsManagement/archive/archiveInfo/relationshipForm.html ?>
</div>

<style type="text/css">
    #archiveRelationshipsTable .viewRelatedArchive {
        cursor: pointer;
    }
</style>

<script type="text/javascript">
    $('#addArchiveRelationship').on('click', function() {
        $('#archiveRelationshipsTable').addClass('hide');
        $('#archiveRelationshipForm').removeClass('hide');
    });

    $('#archiveRelationshipForm').onEvent('closeRelationshipForm.archive', function() {
        $('#archiveRelationshipForm').addClass('hide');
        $('#archiveRelationshipsTable').removeClass('hide');
    });

    $('#archiveRelationshipForm').onEvent('relationshipAdded.archive', function(e, archiveId, relationship) {
        trigger('showDetails.archive', archiveId);
    })
    $("#archiveRelationshipsTable").on('click', ".viewRelatedArchive", function (e) {
        e.preventDefault();
        trigger('viewRelated.archive', $(this).data('archiveid'));
        $('.modal').scrollTop(0);
    });

    $("#archiveRelationshipsTable").on('click', ".editRelationship", function (e) {
        e.preventDefault();
        btn = $(this);
        trigger('loadRelationship.archiveRelationship', [btn.data('archiveid'), btn.data('procedurealier'), btn.data('typecode'), btn.data('dossier'), btn.data('chainage')]);

        $('#archiveRelationshipsTable').addClass('hide');
        $('#archiveRelationshipForm').removeClass('hide');
    });

</script>
