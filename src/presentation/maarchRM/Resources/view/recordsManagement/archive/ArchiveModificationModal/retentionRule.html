<table id="retentionCode" class="table table-condensed modificationForm">
    <tr id="startDate">
        <td><strong>Start date</strong></td>
        <td>
            <input class='form-control input-sm ruleInput datePicker' name="startDate"/>
            <input type="checkbox" id="resetRetentionStartDate"/> <span>Reset start date</span>
        </td>
    </tr>
    <td><strong>Code</strong></td>
    <td>
         <select id="retentionRuleCode" name="retentionRuleCode" class="form-control input-sm ruleInputAccess">
            <option value="">Select a rule</option>
            <?merge retentionRules ?>
            <option value='[?merge .code ?]' data-json='[?merge .json ?]'><?merge .label ?></option>
        </select>
        <br>
        <dl class="dl dl-horizontal" id="retentionRule">
            <dt><span>Duration</span> : </dt><dd id="retentionRuleDuration"></dd>
            <dt><span>Final disposition</span> : </dt>
            <dd>
                <div class="col-md-6">
                    <select id="finalDisposition" name="finalDisposition" class="form-control input-sm">
                        <option value=''> To be defined later </option>
                        <option value='destruction'>Destruction</option>
                        <option value='preservation'>Preservation</option>
                    </select>
                </div>
            </dd>
            <dt><span>Description</span> : </dt><dd id="retentionRuleDescription"></dd>
        </dl>
    </td>
</table>

<script type="text/javascript">

    $('#resetRetentionStartDate').on('click', function() {
        var input = $('#retentionCode').find('input[name="startDate"]');
        if($(this).is(':checked')) {
            input.val('').prop('disabled', true);
        } else {
            input.prop('disabled', false);
        }
    })

    var retentionRule_serialize = function() {
        var form = $('#retentionCode');
        var parameter = {};
        var code = form.find('[name="retentionRuleCode"]').find('option:selected').data('json');
        parameter.retentionRule = {
            retentionStartDate : form.find('[name="startDate"]').val(),
            retentionRuleCode  : form.find('[name="retentionRuleCode"]').val(),
            retentionDuration  : code.duration,
            finalDisposition   : $('#finalDisposition').val(),
            resetStartDate     : $('#resetRetentionStartDate').is(':checked')
        }
        
        return parameter;
    }

    var retentionRule_load = function(archiveId, archiveName, type) {
        $('#retentionCode').css('display', '');
        ModificationModal.loadRule(archiveId, archiveName, type);
    }

    var retentionRule_loadMultiple = function() {
        $('#retentionCode').css('display', '');
    }
</script>