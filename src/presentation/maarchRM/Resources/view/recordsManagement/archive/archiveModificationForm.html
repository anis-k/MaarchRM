<div class="panel panel-default" id="archiveModificationForm">
    <div class="panel-body">
        <h4>Archive(s)</h4>
        <br/>
        <div class="table-responsive">
            <table class="table table-condensed">
                <tbody>
                    <tr id="selectedArchiveId"><td><strong>Reference</strong></td><td><span></span></td></tr>
                    <tr id="selectedArchiveReference"><td><strong>Archive name</strong></td><td><span></span></td></tr>
                    <tr id="startDate" style="display: none;"><td><strong>Start date</strong></td><td><input class='form-control input-sm ruleInput datePicker' name="startDate"></td></tr>
                    <tr id="accessCode"><td><strong>Code</strong></td><td>
                        <select id="accessRuleCode" name="accessRuleCode" class="form-control input-sm ruleInputAccess">
                                <option value="">Select a rule</option>
                                <?merge accessRules ?>
                                <option value='[?merge .code ?]' data-json='[?merge .json ?]'><?merge .code ?></option>
                        </select><br>
                       
                        <dl id="accessRule">
                            <dt><span>Duration</span> : <span id="accessRuleDuration"></span></dt>
                        </dl>
                        
                    </td></tr>
                    <tr id="retentionCode"><td><strong>Code</strong></td><td>
                         <select id="retentionRuleCode" name="retentionRuleCode" class="form-control input-sm ruleInputAccess">
                                <option value="">Select a rule</option>
                                <?merge retentionRules ?>
                                <option value='[?merge .code ?]' data-json='[?merge .json ?]'><?merge .label ?></option>
                        </select><br>
                        <dl id="retentionRules">
                            <dt><span>Duration</span> : <span id="retentionRuleDuration"></span></dt>
                            <dt><span>Final disposition</span> : <span id="retentionRuleFinalDisposition"></span></dt>
                        </dl>

                    </tr>

                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    
    var ArchiveModification = {
        modal: $('#modificationModal'),
        serialize: function(type) {
            var parameter = {}
            if(type === "accessRule") {
                var code = this.modal.find('[name="accessRuleCode"]').find('option:selected').data('json');
                parameter.accessRule = {
                    accessRuleCode      : this.modal.find('[name="accessRuleCode"]').val(),
                    accessRuleStartDate : this.modal.find('[name="startDate"]').val(),
                    accessRuleDuration  : code.duration
                }
            } else if (type === "retentionRule") {
                var code = this.modal.find('[name="retentionRuleCode"]').find('option:selected').data('json');
                parameter.retentionRule = {
                    retentionStartDate    : this.modal.find('[name="startDate"]').val(),
                    retentionRuleCode     : this.modal.find('[name="retentionRuleCode"]').val(),
                    retentionDuration : code.duration,
                    finalDisposition      : code.finalDisposition
                }
            }

            return parameter;
        }
    }
</script>
